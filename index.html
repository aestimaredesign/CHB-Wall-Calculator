<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHB Wall Estimation Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>CHB Wall Estimation Calculator</h1>
            <p>Compliant with NSCP, ACI, ASTM, and Eurocode standards</p>
        </header>
                <div class="left-column">
            <div class="project-info">
                <h2>Project Information</h2>
                <div class="form-group">
                    <label for="projectName">Project Name</label>
                    <input type="text" id="projectName" value="Residential Boundary Wall">
                </div>
                <div class="form-group">
                    <label for="clientName">Client Name</label>
                    <input type="text" id="clientName" value="John Dela Cruz">
                </div>
                <div class="form-group">
                    <label for="projectLocation">Project Location</label>
                    <input type="text" id="projectLocation" value="Manila, Philippines">
                </div>
                <div class="form-group">
                    <label for="preparedBy">Prepared By</label>
                    <input type="text" id="preparedBy" value="Maria Santos, Civil Engineer">
                </div>
            </div>
                        <div class="card">
                <div class="tabs">
                    <div class="tab active" data-tab="dimensions">Dimensions</div>
                    <div class="tab" data-tab="materials">Materials</div>
                    <div class="tab" data-tab="labor">Labor & Costs</div>
                    <div class="tab" data-tab="factors">Adjustment Factors</div>
                    <div class="tab" data-tab="help">Help & Formulas</div>
                </div>
                
                <form id="calculatorForm">
                    <div class="tab-content active" id="dimensions-tab">
                        <!-- Dimensions content will be in the next batch -->
                    </div>
                    <div class="tab-content" id="materials-tab">
                        <!-- Materials content will be in a later batch -->
                    </div>
                    <div class="tab-content" id="labor-tab">
                        <!-- Labor content will be in a later batch -->
                    </div>
                    <div class="tab-content" id="factors-tab">
                        <!-- Factors content will be in a later batch -->
                    </div>
                    <div class="tab-content" id="help-tab">
                        <!-- Help content will be in a later batch -->
                    </div>
                    
                    <button type="button" id="calculateBtn" class="btn btn-block">Calculate Estimate</button>
                    <button type="button" id="resetBtn" class="btn btn-block reset-btn">Reset Form</button>
                </form>
            </div>
                                <div class="tab-content active" id="dimensions-tab">
                        <div class="form-group">
                            <label for="wallLength">Wall Length (m)</label>
                            <input type="number" id="wallLength" step="0.01" min="0.1" value="10" required>
                            <div class="error-text" id="wallLengthError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="wallHeight">Wall Height (m)</label>
                            <input type="number" id="wallHeight" step="0.01" min="0.1" value="3" required>
                            <div class="error-text" id="wallHeightError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="chbSize">CHB Size</label>
                            <select id="chbSize">
                                <option value="0.1">4" (100mm) thick</option>
                                <option value="0.15" selected>6" (150mm) thick</option>
                                <option value="0.2">8" (200mm) thick</option>
                            </select>
                        </div>
                        
                        <h3>Openings</h3>
                        
                        <div class="form-group">
                            <label for="doorCount">Number of Doors</label>
                            <input type="number" id="doorCount" min="0" value="1">
                            <div class="error-text" id="doorCountError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="doorWidth">Average Door Width (m)</label>
                            <input type="number" id="doorWidth" step="0.01" min="0.5" value="0.9">
                            <div class="error-text" id="doorWidthError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="doorHeight">Average Door Height (m)</label>
                            <input type="number" id="doorHeight" step="0.01" min="1.5" value="2.1">
                            <div class="error-text" id="doorHeightError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="windowCount">Number of Windows</label>
                            <input type="number" id="windowCount" min="0" value="2">
                            <div class="error-text" id="windowCountError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="windowWidth">Average Window Width (m)</label>
                            <input type="number" id="windowWidth" step="0.01" min="0.3" value="1.2">
                            <div class="error-text" id="windowWidthError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="windowHeight">Average Window Height (m)</label>
                            <input type="number" id="windowHeight" step="0.01" min="0.3" value="1.2">
                            <div class="error-text" id="windowHeightError"></div>
                        </div>
                    </div>
                                        <div class="tab-content" id="materials-tab">
                        <div class="form-group">
                            <label for="standard">Design Standard <span class="tooltip">ℹ️
                                <span class="tooltiptext">Select the building code standard for reinforcement and plaster specifications</span>
                            </span></label>
                            <select id="standard">
                                <option value="nscp">NSCP (Philippines)</option>
                                <option value="aci">ACI (American)</option>
                                <option value="astm">ASTM</option>
                                <option value="eurocode">Eurocode</option>
                            </select>
                        </div>
                        
                        <h3>Reinforcement</h3>
                        
                        <div class="rebar-options">
                            <div class="form-group">
                                <label for="rebarVertSpacing">Vertical Bar Spacing (mm) <span class="tooltip">ℹ️
                                    <span class="tooltiptext">Distance between vertical reinforcing bars</span>
                                </span></label>
                                <input type="number" id="rebarVertSpacing" value="800" min="400" step="100">
                            </div>
                            
                            <div class="form-group">
                                <label for="rebarHorizSpacing">Horizontal Bar Layers <span class="tooltip">ℹ️
                                    <span class="tooltiptext">Number of CHB courses between horizontal bars (typically every 3rd course)</span>
                                </span></label>
                                <input type="number" id="rebarHorizSpacing" value="3" min="1" step="1">
                            </div>
                            
                            <div class="form-group">
                                <label for="rebarDiameter">Rebar Diameter (mm)</label>
                                <select id="rebarDiameter">
                                    <option value="10">10mm</option>
                                    <option value="12" selected>12mm</option>
                                    <option value="16">16mm</option>
                                </select>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="includeLaps" checked>
                                <label for="includeLaps">Include lap splices and hooks</label>
                            </div>
                            
                            <div class="form-group">
                                <label for="lapLength">Lap Length (mm) <span class="tooltip">ℹ️
                                    <span class="tooltiptext">Based on rebar diameter and code requirements</span>
                                </span></label>
                                <input type="number" id="lapLength" value="480" min="300" step="10">
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="cornerBars">
                                <label for="cornerBars">Include corner bars</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="lintelBars">
                                <label for="lintelBars">Include lintel reinforcement</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="dowelBars">
                                <label for="dowelBars">Include dowel bars</label>
                            </div>
                        </div>
                        
                        <h3>Mortar & Plaster</h3>
                        
                        <div class="form-group">
                            <label for="mortarRatio">Mortar Mix Ratio <span class="tooltip">ℹ️
                                <span class="tooltiptext">Cement to sand ratio for mortar</span>
                            </span></label>
                            <select id="mortarRatio">
                                <option value="1:3">1:3 (Rich mix)</option>
                                <option value="1:4" selected>1:4 (Standard)</option>
                                <option value="1:5">1:5 (Economy)</option>
                                <option value="1:6">1:6 (Lean mix)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="cementFactor">Cement Factor (bags/m³) <span class="tooltip">ℹ️
                                <span class="tooltiptext">Varies by standard and mix ratio</span>
                            </span></label>
                            <input type="number" id="cementFactor" step="0.1" min="7" max="12" value="9">
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="plastering" checked>
                            <label for="plastering">Include plastering</label>
                        </div>
                        
                        <div class="plaster-options">
                            <div class="form-group">
                                <label for="plasterSides">Plaster Sides</label>
                                <select id="plasterSides">
                                    <option value="1">One Side Only</option>
                                    <option value="2" selected>Both Sides</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="plasterRatio">Plaster Mix Ratio <span class="tooltip">ℹ️
                                    <span class="tooltiptext">Cement to sand ratio for plaster</span>
                                </span></label>
                                <select id="plasterRatio">
                                    <option value="1:2">1:2 (Rich mix)</option>
                                    <option value="1:3" selected>1:3 (Standard)</option>
                                    <option value="1:4">1:4 (Economy)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="plasterCementFactor">Plaster Cement Factor (bags/m³) <span class="tooltip">ℹ️
                                    <span class="tooltiptext">Varies by standard and mix ratio</span>
                                </span></label>
                                <input type="number" id="plasterCementFactor" step="0.1" min="10" max="16" value="12">
                            </div>
                            
                            <div class="form-group">
                                <label for="plasterThickness">Plaster Thickness (mm) <span class="tooltip">ℹ️
                                    <span class="tooltiptext">Thickness of plaster on each side</span>
                                </span></label>
                                <input type="number" id="plasterThickness" value="20" min="10" max="30" step="5">
                            </div>
                        </div>
                    </div>
                                        <div class="tab-content" id="labor-tab">
                        <div class="form-group">
                            <label for="productivityRate">Productivity Rate (m²/day) <span class="tooltip">ℹ️
                                <span class="tooltiptext">Area of CHB wall a mason can complete in one day</span>
                            </span></label>
                            <select id="productivityRate">
                                <option value="4">4 m²/day (Complex work)</option>
                                <option value="6">6 m²/day (High quality)</option>
                                <option value="8" selected>8 m²/day (Standard quality)</option>
                                <option value="10">10 m²/day (Economy)</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="customRateContainer" style="display: none;">
                            <label for="customRate">Custom Rate (m²/day)</label>
                            <input type="number" id="customRate" min="4" max="15" step="0.5" value="8">
                        </div>
                        
                        <div class="productivity-library">
                            <h4>Productivity Adjustment Factors</h4>
                            <div class="productivity-item">
                                <span>Wall Complexity:</span>
                                <select id="complexityFactor">
                                    <option value="1.0">Simple (straight walls)</option>
                                    <option value="0.9" selected>Moderate (some corners)</option>
                                    <option value="0.8">Complex (many corners/angles)</option>
                                </select>
                            </div>
                            <div class="productivity-item">
                                <span>Scaffolding Required:</span>
                                <select id="scaffoldingFactor">
                                    <option value="1.0">None (low height)</option>
                                    <option value="0.95" selected>Moderate (medium height)</option>
                                    <option value="0.9">Extensive (high walls)</option>
                                </select>
                            </div>
                            <div class="productivity-item">
                                <span>Opening Complexity:</span>
                                <select id="openingFactor">
                                    <option value="1.0">Few openings</option>
                                    <option value="0.95" selected>Moderate openings</option>
                                    <option value="0.9">Many openings</option>
                                </select>
                            </div>
                        </div>
                        
                        <h3>Crew Composition</h3>
                        
                        <div class="form-group">
                            <label for="masons">Masons</label>
                            <input type="number" id="masons" min="1" value="2">
                        </div>
                        
                        <div class="form-group">
                            <label for="helpers">Helpers</label>
                            <input type="number" id="helpers" min="0" value="2">
                        </div>
                        
                        <div class="form-group">
                            <label for="carpenters">Carpenters (for forms)</label>
                            <input type="number" id="carpenters" min="0" value="1">
                        </div>
                        
                        <h3>Costs</h3>
                        
                        <div class="form-group">
                            <label for="chbCost">CHB Cost per Piece</label>
                            <input type="number" id="chbCost" step="0.01" min="0" value="25">
                        </div>
                        
                        <div class="form-group">
                            <label for="cementCost">Cement Cost per Bag (40kg)</label>
                            <input type="number" id="cementCost" step="0.01" min="0" value="250">
                        </div>
                        
                        <div class="form-group">
                            <label for="sandCost">Sand Cost per m³</label>
                            <input type="number" id="sandCost" step="0.01" min="0" value="800">
                        </div>
                        
                        <div class="form-group">
                            <label for="rebarCost">Rebar Cost per kg</label>
                            <input type="number" id="rebarCost" step="0.01" min="0" value="45">
                        </div>
                        
                        <div class="form-group">
                            <label for="masonDailyRate">Mason Daily Rate</label>
                            <input type="number" id="masonDailyRate" step="0.01" min="0" value="600">
                        </div>
                        
                        <div class="form-group">
                            <label for="helperDailyRate">Helper Daily Rate</label>
                            <input type="number" id="helperDailyRate" step="0.01" min="0" value="400">
                        </div>
                        
                        <div class="form-group">
                            <label for="carpenterDailyRate">Carpenter Daily Rate</label>
                            <input type="number" id="carpenterDailyRate" step="0.01" min="0" value="500">
                        </div>
                    </div>
                                        <div class="tab-content" id="factors-tab">
                        <div class="form-group">
                            <label for="wasteFactor">Waste Factor (%)</label>
                            <div class="factor-slider">
                                <input type="range" id="wasteFactorSlider" min="0" max="20" value="5">
                                <span class="factor-value" id="wasteFactorValue">5%</span>
                            </div>
                            <input type="hidden" id="wasteFactor" value="5">
                        </div>
                        
                        <div class="form-group">
                            <label for="weatherFactor">Weather Conditions <span class="tooltip">ℹ️
                                <span class="tooltiptext">Adjusts productivity based on weather conditions</span>
                            </span></label>
                            <div class="factor-slider">
                                <input type="range" id="weatherFactorSlider" min="80" max="120" value="100">
                                <span class="factor-value" id="weatherFactorValue">100%</span>
                            </div>
                            <input type="hidden" id="weatherFactor" value="100">
                        </div>
                        
                        <div class="form-group">
                            <label for="crewSkill">Crew Skill Level <span class="tooltip">ℹ️
                                <span class="tooltiptext">Adjusts productivity based on crew experience</span>
                            </span></label>
                            <div class="factor-slider">
                                <input type="range" id="crewSkillSlider" min="70" max="130" value="100">
                                <span class="factor-value" id="crewSkillValue">100%</span>
                            </div>
                            <input type="hidden" id="crewSkill" value="100">
                        </div>
                        
                        <div class="form-group">
                            <label for="siteAccess">Site Access Difficulty <span class="tooltip">ℹ️
                                <span class="tooltiptext">Adjusts productivity based on site conditions</span>
                            </span></label>
                            <div class="factor-slider">
                                <input type="range" id="siteAccessSlider" min="80" max="120" value="100">
                                <span class="factor-value" id="siteAccessValue">100%</span>
                            </div>
                            <input type="hidden" id="siteAccess" value="100">
                        </div>
                        
                        <div class="form-group">
                            <label for="overhead">Overhead (%)</label>
                            <div class="factor-slider">
                                <input type="range" id="overheadSlider" min="0" max="30" value="15">
                                <span class="factor-value" id="overheadValue">15%</span>
                            </div>
                            <input type="hidden" id="overhead" value="15">
                        </div>
                        
                        <div class="form-group">
                            <label for="profitMargin">Profit Margin (%)</label>
                            <div class="factor-slider">
                                <input type="range" id="profitMarginSlider" min="0" max="30" value="10">
                                <span class="factor-value" id="profitMarginValue">10%</span>
                            </div>
                            <input type="hidden" id="profitMargin" value="10">
                        </div>
                    </div>
                                        <div class="tab-content" id="help-tab">
                        <div class="help-section">
                            <h3>Adjustment Factors Explained</h3>
                            
                            <div class="adjustment-factor">
                                <div class="factor-name">Waste Factor</div>
                                <p>Accounts for material loss during construction due to cutting, breakage, or other inefficiencies. Typical values range from 5-10%.</p>
                            </div>
                            
                            <div class="adjustment-factor">
                                <div class="factor-name">Weather Conditions</div>
                                <p>Adjusts productivity based on weather impact. Rainy conditions may reduce productivity by 20%, while ideal conditions may increase it by 10%.</p>
                            </div>
                            
                            <div class="adjustment-factor">
                                <div class="factor-name">Crew Skill Level</div>
                                <p>Accounts for the experience and efficiency of the construction crew. Highly skilled crews can be 30% more productive than inexperienced ones.</p>
                            </div>
                            
                            <div class="adjustment-factor">
                                <div class="factor-name">Site Access Difficulty</div>
                                <p>Considers how easy or difficult it is to access the construction site. Limited access can reduce productivity by up to 20%.</p>
                            </div>
                            
                            <div class="adjustment-factor">
                                <div class="factor-name">Overhead</div>
                                <p>Covers indirect costs like supervision, tools, equipment, and administrative expenses. Typically ranges from 10-20% of direct costs.</p>
                            </div>
                            
                            <div class="adjustment-factor">
                                <div class="factor-name">Profit Margin</div>
                                <p>The contractor's profit added to the project cost. Typically ranges from 10-20% of the total cost.</p>
                            </div>
                            
                            <h3>Calculation Formulas</h3>
                            
                            <div class="formula-box">
                                <div class="formula-title">Wall Area Calculation</div>
                                <span class="formula">Net Wall Area = (Length × Height) - (Door Area + Window Area)</span>
                                <p>Where Door Area = Number of Doors × Door Width × Door Height</p>
                                <p>Window Area = Number of Windows × Window Width × Window Height</p>
                            </div>
                            
                            <div class="formula-box">
                                <div class="formula-title">CHB Quantity Calculation</div>
                                <span class="formula">CHB Quantity = Ceiling(Net Wall Area / 0.08)</span>
                                <p>Standard CHB size is 0.4m × 0.2m = 0.08m² per piece</p>
                            </div>
                            
                            <div class="formula-box">
                                <div class="formula-title">Mortar Calculation</div>
                                <span class="formula">Mortar Volume = Net Wall Area × CHB Thickness × 0.25</span>
                                <p>25% of wall volume is estimated to be mortar for joints</p>
                            </div>
                            
                            <div class="formula-box">
                                <div class="formula-title">Cement Calculation</div>
                                <span class="formula">Cement Bags = Mortar Volume × (Cement Part / Total Parts) × Cement Factor</span>
                                <p>Cement factor varies by mix ratio (typically 9-12 bags per m³)</p>
                            </div>
                            
                            <div class="formula-box">
                                <div class="formula-title">Sand Calculation</div>
                                <span class="formula">Sand Volume = Mortar Volume × (Sand Part / Total Parts)</span>
                                <p>For 1:4 mix ratio, sand part is 4 of 5 total parts</p>
                            </div>
                            
                            <div class="formula-box">
                                <div class="formula-title">Rebar Calculation</div>
                                <span class="formula">Vertical Bars = Ceiling(Length / Vertical Spacing) + 1</span>
                                <span class="formula">Horizontal Bars = Ceiling(Height / (0.2 × Horizontal Layers))</span>
                                <p>Standard CHB height is 0.2m per course</p>
                            </div>
                            
                            <div class="formula-box">
                                <div class="formula-title">Labor Calculation</div>
                                <span class="formula">Labor Days = Net Wall Area / (Productivity Rate × Weather Factor × Crew Skill × Site Access)</span>
                                <p>Adjusted for various productivity factors</p>
                            </div>
                        </div>
                    </div>
                            </div>
        
        <div class="right-column">
            <div class="card">
                <h2>Wall Visualization</h2>
                <div class="visualization-controls">
                    <button class="btn" id="zoomIn">Zoom In</button>
                    <button class="btn" id="zoomOut">Zoom Out</button>
                    <button class="btn" id="resetView">Reset View</button>
                </div>
                <div class="visualization">
                    <canvas id="wallCanvas" width="600" height="400"></canvas>
                </div>
                <div class="visualization-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #f9f9f9;"></div>
                        <span>CHB Blocks</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: rgba(200, 200, 255, 0.5);"></div>
                        <span>Openings</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: red;"></div>
                        <span>Rebar</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Bill of Quantities</h2>
                <div id="boq">
                    <p class="alert alert-warning">Calculation required to generate BOQ</p>
                </div>
                <div class="export-buttons">
                    <button class="btn" id="exportPDF">Export PDF</button>
                    <button class="btn" id="exportExcel">Export Excel</button>
                </div>
            </div>
        </div>
    </div>
        <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #c0392b;
            --gray: #95a5a6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 20px;
        }
        
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        header {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }
    </style>
            .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        h3 {
            color: var(--dark);
            margin: 15px 0 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            display: inline-block;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-block {
            display: block;
            width: 100%;
            text-align: center;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #219955;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #a33226;
        }
            table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--light);
            font-weight: 600;
        }
        
        tr:hover {
            background-color: rgba(236, 240, 241, 0.5);
        }
        
        .cost-summary {
            background: var(--light);
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .cost-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .cost-total {
            font-weight: 600;
            font-size: 1.2em;
            border-top: 2px solid var(--dark);
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .visualization {
            background: white;
            border-radius: 8px;
            padding: 20px;
            height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        canvas {
            border: 1px solid #ddd;
            background: #f9f9f9;
            max-width: 100%;
            max-height: 100%;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: var(--secondary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
            .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .alert-warning {
            background: rgba(243, 156, 18, 0.2);
            border-left: 4px solid var(--warning);
        }
        
        .alert-danger {
            background: rgba(192, 57, 43, 0.2);
            border-left: 4px solid var(--danger);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--gray);
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
        }
        
        .section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .subsection {
            padding-left: 15px;
            border-left: 3px solid var(--light);
            margin: 15px 0;
        }
        
        .material-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .badge-primary {
            background: var(--secondary);
            color: white;
        }
        
        .badge-success {
            background: var(--success);
            color: white;
        }
        
        .badge-warning {
            background: var(--warning);
            color: white;
        }
        
        .factor-slider {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .factor-slider input[type="range"] {
            flex: 1;
        }
        
        .factor-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
        }
        
        .boq-table td:last-child, 
        .boq-table th:last-child {
            text-align: right;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .input-error {
            border-color: var(--danger);
            box-shadow: 0 0 0 2px rgba(192, 57, 43, 0.2);
        }
        
        .error-text {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
        }
        
        .visualization-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .visualization-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
        }
        
        .help-section {
            margin-top: 20px;
            padding: 15px;
            background: var(--light);
            border-radius: 4px;
        }
        
        .help-section details {
            margin-bottom: 10px;
        }
        
        .help-section summary {
            font-weight: 600;
            cursor: pointer;
        }
        
        .help-section p {
            margin-top: 10px;
        }
        
        .qs-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .qs-table th, .qs-table td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        
        .qs-table th:first-child, .qs-table td:first-child {
            text-align: left;
        }
        
        .qs-table th {
            background-color: var(--light);
        }
        
        .qs-table .total-row {
            font-weight: bold;
            border-top: 2px solid var(--dark);
        }
        
        .productivity-library {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .productivity-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .rebar-options {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .plaster-options {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .project-info {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .formula-box {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid var(--secondary);
            margin: 10px 0;
        }
        
        .formula-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .formula {
            font-family: monospace;
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            display: block;
        }
        
        .adjustment-factor {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ddd;
        }
        
        .factor-name {
            font-weight: bold;
            color: var(--primary);
        }
        
        .reset-btn {
            background: var(--warning);
            margin-top: 20px;
        }
        
        .reset-btn:hover {
            background: #e67e22;
        }
        
        .grey-header {
            background-color: #e0e0e0 !important;
            font-weight: bold !important;
        }
    </style>
        <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Global variables
        let zoomLevel = 1;
        let canvas, ctx;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize canvas
            canvas = document.getElementById('wallCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size based on container
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Tab functionality
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    // Hide all tab contents
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Show the corresponding tab content
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId + '-tab').classList.add('active');
                });
            });
            
            // Custom productivity rate toggle
            const productivityRate = document.getElementById('productivityRate');
            const customRateContainer = document.getElementById('customRateContainer');
            
            productivityRate.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customRateContainer.style.display = 'block';
                } else {
                    customRateContainer.style.display = 'none';
                }
            });
                        // Slider event listeners
            ['wasteFactor', 'weatherFactor', 'crewSkill', 'siteAccess', 'overhead', 'profitMargin'].forEach(factor => {
                const slider = document.getElementById(`${factor}Slider`);
                const valueSpan = document.getElementById(`${factor}Value`);
                const hiddenInput = document.getElementById(factor);
                
                slider.addEventListener('input', function() {
                    const value = this.value;
                    valueSpan.textContent = factor.includes('Factor') ? `${value}%` : `${value}%`;
                    hiddenInput.value = value / 100; // Store as decimal for calculations
                });
            });
            
            // Canvas controls
            document.getElementById('zoomIn').addEventListener('click', () => {
                zoomLevel = Math.min(2, zoomLevel + 0.1);
                drawWall();
            });
            
            document.getElementById('zoomOut').addEventListener('click', () => {
                zoomLevel = Math.max(0.5, zoomLevel - 0.1);
                drawWall();
            });
            
            document.getElementById('resetView').addEventListener('click', () => {
                zoomLevel = 1;
                drawWall();
            });
            
            // Calculate button
            document.getElementById('calculateBtn').addEventListener('click', calculateEstimate);
            
            // Reset button
            document.getElementById('resetBtn').addEventListener('click', resetForm);
            
            // Export buttons
            document.getElementById('exportPDF').addEventListener('click', generatePDF);
            document.getElementById('exportExcel').addEventListener('click', generateExcel);
            
            // Initial draw
            drawWall();
        });
        
        function resizeCanvas() {
            const container = document.querySelector('.visualization');
            canvas.width = container.clientWidth - 40; // Adjust for padding
            canvas.height = 400; // Fixed height for now
            drawWall();
        }
        
        function drawWall() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.scale(zoomLevel, zoomLevel);
            
            const wallLength = parseFloat(document.getElementById('wallLength').value) || 10;
            const wallHeight = parseFloat(document.getElementById('wallHeight').value) || 3;
            const chbSize = parseFloat(document.getElementById('chbSize').value) || 0.15;
            
            const scaleX = (canvas.width / zoomLevel) / (wallLength * 1.2);
            const scaleY = (canvas.height / zoomLevel) / (wallHeight * 1.2);
            const scale = Math.min(scaleX, scaleY);
            
            const offsetX = (canvas.width / zoomLevel - wallLength * scale) / 2;
            const offsetY = (canvas.height / zoomLevel - wallHeight * scale) / 2;
            
            // Draw CHB blocks
            ctx.fillStyle = '#f9f9f9';
            for (let y = 0; y < wallHeight; y += 0.2) {
                for (let x = 0; x < wallLength; x += 0.4) {
                    ctx.fillRect(offsetX + x * scale, offsetY + y * scale, 0.4 * scale, 0.2 * scale);
                }
            }
            
            // Draw openings (simplified)
            const doorCount = parseInt(document.getElementById('doorCount').value) || 1;
            const doorWidth = parseFloat(document.getElementById('doorWidth').value) || 0.9;
            const doorHeight = parseFloat(document.getElementById('doorHeight').value) || 2.1;
            const windowCount = parseInt(document.getElementById('windowCount').value) || 2;
            const windowWidth = parseFloat(document.getElementById('windowWidth').value) || 1.2;
            const windowHeight = parseFloat(document.getElementById('windowHeight').value) || 1.2;
            
            ctx.fillStyle = 'rgba(200, 200, 255, 0.5)';
            for (let i = 0; i < doorCount; i++) {
                ctx.fillRect(offsetX + (i * 1.5 + 0.5) * scale, offsetY + 0.5 * scale, doorWidth * scale, doorHeight * scale);
            }
            for (let i = 0; i < windowCount; i++) {
                ctx.fillRect(offsetX + (i * 1.5 + 0.5) * scale, offsetY + (wallHeight - 1.5) * scale, windowWidth * scale, windowHeight * scale);
            }
            
            // Draw rebar (simplified vertical lines)
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 2 / zoomLevel;
            const rebarVertSpacing = parseInt(document.getElementById('rebarVertSpacing').value) / 1000 || 0.8;
            for (let x = 0; x < wallLength; x += rebarVertSpacing) {
                ctx.beginPath();
                ctx.moveTo(offsetX + x * scale, offsetY);
                ctx.lineTo(offsetX + x * scale, offsetY + wallHeight * scale);
                ctx.stroke();
            }
            
            ctx.restore();
        }
    </script>
        <script>
        function calculateEstimate() {
            const errors = validateInputs();
            if (errors.length > 0) {
                errors.forEach(error => {
                    const [id, message] = error;
                    const errorElement = document.getElementById(`${id}Error`);
                    if (errorElement) {
                        errorElement.textContent = message;
                        document.getElementById(id).classList.add('input-error');
                    }
                });
                return;
            }
            
            // Clear previous errors
            document.querySelectorAll('.error-text').forEach(el => el.textContent = '');
            document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
            
            const data = {
                wallLength: parseFloat(document.getElementById('wallLength').value),
                wallHeight: parseFloat(document.getElementById('wallHeight').value),
                chbSize: parseFloat(document.getElementById('chbSize').value),
                doorCount: parseInt(document.getElementById('doorCount').value),
                doorWidth: parseFloat(document.getElementById('doorWidth').value),
                doorHeight: parseFloat(document.getElementById('doorHeight').value),
                windowCount: parseInt(document.getElementById('windowCount').value),
                windowWidth: parseFloat(document.getElementById('windowWidth').value),
                windowHeight: parseFloat(document.getElementById('windowHeight').value),
                rebarVertSpacing: parseInt(document.getElementById('rebarVertSpacing').value) / 1000,
                rebarHorizSpacing: parseInt(document.getElementById('rebarHorizSpacing').value),
                rebarDiameter: parseInt(document.getElementById('rebarDiameter').value),
                includeLaps: document.getElementById('includeLaps').checked,
                lapLength: parseInt(document.getElementById('lapLength').value) / 1000,
                cornerBars: document.getElementById('cornerBars').checked,
                lintelBars: document.getElementById('lintelBars').checked,
                dowelBars: document.getElementById('dowelBars').checked,
                mortarRatio: document.getElementById('mortarRatio').value.split(':').map(Number),
                cementFactor: parseFloat(document.getElementById('cementFactor').value),
                plastering: document.getElementById('plastering').checked,
                plasterSides: parseInt(document.getElementById('plasterSides').value),
                plasterRatio: document.getElementById('plasterRatio').value.split(':').map(Number),
                plasterCementFactor: parseFloat(document.getElementById('plasterCementFactor').value),
                plasterThickness: parseInt(document.getElementById('plasterThickness').value) / 1000,
                productivityRate: parseFloat(document.getElementById('productivityRate').value === 'custom' 
                    ? document.getElementById('customRate').value : document.getElementById('productivityRate').value),
                complexityFactor: parseFloat(document.getElementById('complexityFactor').value),
                scaffoldingFactor: parseFloat(document.getElementById('scaffoldingFactor').value),
                openingFactor: parseFloat(document.getElementById('openingFactor').value),
                masons: parseInt(document.getElementById('masons').value),
                helpers: parseInt(document.getElementById('helpers').value),
                carpenters: parseInt(document.getElementById('carpenters').value),
                chbCost: parseFloat(document.getElementById('chbCost').value),
                cementCost: parseFloat(document.getElementById('cementCost').value),
                sandCost: parseFloat(document.getElementById('sandCost').value),
                rebarCost: parseFloat(document.getElementById('rebarCost').value),
                masonDailyRate: parseFloat(document.getElementById('masonDailyRate').value),
                helperDailyRate: parseFloat(document.getElementById('helperDailyRate').value),
                carpenterDailyRate: parseFloat(document.getElementById('carpenterDailyRate').value),
                wasteFactor: parseFloat(document.getElementById('wasteFactor').value),
                weatherFactor: parseFloat(document.getElementById('weatherFactor').value) / 100,
                crewSkill: parseFloat(document.getElementById('crewSkill').value) / 100,
                siteAccess: parseFloat(document.getElementById('siteAccess').value) / 100,
                overhead: parseFloat(document.getElementById('overhead').value) / 100,
                profitMargin: parseFloat(document.getElementById('profitMargin').value) / 100
            };
            
            const boq = generateBOQ(data);
            const boqDiv = document.getElementById('boq');
            boqDiv.innerHTML = '';
            const table = document.createElement('table');
            table.className = 'qs-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Quantity</th>
                        <th>Unit</th>
                        <th>Unit Rate</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>${boq.map(row => `<tr>${row.cells.map(cell => `<td>${cell.textContent}</td>`).join('')}</tr>`).join('')}</tbody>
            `;
            boqDiv.appendChild(table);
            
            drawWall();
        }
        
        function validateInputs() {
            const errors = [];
            const wallLength = document.getElementById('wallLength').value;
            const wallHeight = document.getElementById('wallHeight').value;
            if (wallLength <= 0 || wallLength > 100) errors.push(['wallLength', 'Wall length must be between 0.1 and 100m']);
            if (wallHeight <= 0 || wallHeight > 10) errors.push(['wallHeight', 'Wall height must be between 0.1 and 10m']);
            return errors;
        }
        
        function generateBOQ(data) {
            const boq = [];
            
            // Materials section
            boq.push({ cells: ['Materials', '', '', '', ''], class: 'grey-header' });
            boq.push({ cells: ['CHB Blocks', data.chbQuantity.toFixed(2), 'pcs', `₱${data.chbCost.toFixed(2)}`, `₱${(data.chbQuantity * data.chbCost).toFixed(2)}`] });
            boq.push({ cells: ['Cement', data.cementBagsMortar.toFixed(2), 'bags', `₱${data.cementCost.toFixed(2)}`, `₱${(data.cementBagsMortar * data.cementCost).toFixed(2)}`] });
            boq.push({ cells: ['Sand', data.sandMortar.toFixed(2), 'm³', `₱${data.sandCost.toFixed(2)}`, `₱${(data.sandMortar * data.sandCost).toFixed(2)}`] });
            boq.push({ cells: ['Rebar (12mm)', data.rebarWeight.toFixed(2), 'kg', `₱${data.rebarCost.toFixed(2)}`, `₱${(data.rebarWeight * data.rebarCost).toFixed(2)}`] });
            boq.push({ cells: ['Materials Subtotal', '', '', '', `₱${data.totalMaterialCost.toFixed(2)}`], class: 'total-row' });
            boq.push({ cells: ['Waste (' + (data.wasteFactor * 100) + '%)', '', '', '', `₱${(data.totalMaterialCost * data.wasteFactor).toFixed(2)}`] });
            boq.push({ cells: ['Materials Total', '', '', '', `₱${(data.totalMaterialCost * (1 + data.wasteFactor)).toFixed(2)}`], class: 'total-row' });
            boq.push({ cells: ['', '', '', '', ''], class: 'grey-header' });
            
            // Labor section
            boq.push({ cells: ['Labor', '', '', '', ''], class: 'grey-header' });
            boq.push({ cells: ['Mason', data.masons, 'days', `₱${data.masonDailyRate.toFixed(2)}`, `₱${(data.masons * data.laborDays * data.masonDailyRate).toFixed(2)}`] });
            boq.push({ cells: ['Helper', data.helpers, 'days', `₱${data.helperDailyRate.toFixed(2)}`, `₱${(data.helpers * data.laborDays * data.helperDailyRate).toFixed(2)}`] });
            boq.push({ cells: ['Carpenter', data.carpenters, 'days', `₱${data.carpenterDailyRate.toFixed(2)}`, `₱${(data.carpenters * data.laborDays * data.carpenterDailyRate).toFixed(2)}`] });
            boq.push({ cells: ['Labor Total', '', '', '', `₱${data.totalLaborCost.toFixed(2)}`], class: 'total-row' });
            boq.push({ cells: ['', '', '', '', ''], class: 'grey-header' });
            
            // Summary section
            boq.push({ cells: ['Summary', '', '', '', ''], class: 'grey-header' });
            boq.push({ cells: ['Materials + Labor', '', '', '', `₱${(data.totalMaterialCost * (1 + data.wasteFactor) + data.totalLaborCost).toFixed(2)}`] });
            boq.push({ cells: ['Overhead', '', '', '', `₱${data.overheadAmount.toFixed(2)}`] });
            boq.push({ cells: ['Profit Margin', '', '', '', `₱${data.profitAmount.toFixed(2)}`] });
            boq.push({ cells: ['TOTAL PROJECT COST', '', '', '', `₱${data.totalProjectCost.toFixed(2)}`], class: 'total-row' });
            
            return boq;
        }
        
        function resetForm() {
            document.getElementById('calculatorForm').reset();
            document.getElementById('boq').innerHTML = '<p class="alert alert-warning">Calculation required to generate BOQ</p>';
            document.querySelectorAll('.error-text').forEach(el => el.textContent = '');
            document.querySelectorAll('.input-error').forEach(el => el.classList.remove('input-error'));
            customRateContainer.style.display = 'none';
            zoomLevel = 1;
            drawWall();
        }
    </script>
        <script>
        function generatePDF() {
            try {
                const doc = new jsPDF();
                
                // Get project information
                const projectName = document.getElementById("projectName")?.value || "Residential Boundary Wall";
                const clientName = document.getElementById("clientName")?.value || "John Dela Cruz";
                const projectLocation = document.getElementById("projectLocation")?.value || "Manila, Philippines";
                const preparedBy = document.getElementById("preparedBy")?.value || "Maria Santos, Civil Engineer";
                const date = new Date().toLocaleDateString();
                
                // Set margins and initial position
                const margin = 15;
                let y = margin;
                
                // Add header information
                doc.setFontSize(18);
                doc.setFont("helvetica", "bold");
                doc.text("CHB Wall Estimation Report", margin, y);
                y += 10;
                
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                doc.text(`Project: ${projectName}`, margin, y);
                doc.text(`Client: ${clientName}`, 100, y);
                y += 5;
                doc.text(`Location: ${projectLocation}`, margin, y);
                doc.text(`Date: ${date}`, 100, y);
                y += 5;
                doc.text(`Prepared by: ${preparedBy}`, margin, y);
                y += 15;
                
                // Add Bill of Quantities title
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text("Bill of Quantities", margin, y);
                y += 15;
                
                // Generate BOQ data
                const data = {
                    chbQuantity: 316,
                    cementBagsMortar: 6,
                    plasterCementBags: 0,
                    sandMortar: 1.51,
                    plasterSand: 0,
                    rebarWeight: 99,
                    laborDays: 2.33,
                    masons: 2,
                    helpers: 2,
                    carpenters: 1,
                    chbCost: 25,
                    cementCost: 250,
                    sandCost: 800,
                    rebarCostPerKg: 45,
                    masonDailyRate: 600,
                    helperDailyRate: 400,
                    carpenterDailyRate: 500,
                    totalMaterialCost: 15066.04,
                    totalLaborCost: 9706.83,
                    wasteFactor: 0.05,
                    overheadAmount: 3828.93,
                    profitAmount: 2935.51,
                    totalProjectCost: 32290.61
                };
                const boqData = generateBOQ(data);
                
                // Configure and draw the table
                doc.autoTable({
                    head: [["Description", "Quantity", "Unit", "Unit Rate", "Amount"]],
                    body: boqData.map(row => row.cells),
                    startY: y,
                    theme: "grid",
                    styles: {
                        fontSize: 8,
                        cellPadding: { top: 3, right: 3, bottom: 3, left: 3 },
                        valign: "middle"
                    },
                    columnStyles: {
                        0: { halign: "left", cellWidth: 70 },
                        1: { halign: "center", cellWidth: 20 },
                        2: { halign: "center", cellWidth: 20 },
                        3: { halign: "right", cellWidth: 30 },
                        4: { halign: "right", cellWidth: 35 }
                    },
                    headStyles: {
                        fillColor: [220, 220, 220],
                        textColor: 20,
                        fontStyle: "bold"
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    },
                    rowPageBreak: 'avoid',
                    didParseCell: function(data) {
                        const rowText = (data.cell.raw || '').toString();
                        if (rowText === "Materials" || rowText === "Labor" || rowText === "Summary") {
                            data.cell.styles.fillColor = [224, 224, 224];
                            data.cell.styles.fontStyle = 'bold';
                            data.cell.styles.halign = 'left';
                        }
                        if (rowText.includes("Subtotal") || rowText.includes("Total") || rowText.includes("TOTAL")) {
                            data.cell.styles.fontStyle = 'bold';
                            if (data.column.index > 0) data.cell.styles.halign = 'right';
                        }
                    },
                    didDrawPage: function(data) {
                        doc.setFontSize(10);
                        doc.setTextColor(100);
                        doc.text(`Page ${data.pageNumber} of ${doc.internal.getNumberOfPages()}`, 
                                 doc.internal.pageSize.width - 30, doc.internal.pageSize.height - 10, { align: 'right' });
                    },
                    margin: { top: y, left: margin, right: margin }
                });
                
                // Save the PDF
                doc.save("CHB_Wall_Estimate.pdf");
            } catch (error) {
                alert("Error generating PDF: " + error.message);
                console.error(error);
            }
        }
        
        function generateExcel() {
            const wb = XLSX.utils.book_new();
            const wsData = [
                ["Description", "Quantity", "Unit", "Unit Rate", "Amount"],
                ...generateBOQ({
                    chbQuantity: 316,
                    cementBagsMortar: 6,
                    plasterCementBags: 0,
                    sandMortar: 1.51,
                    plasterSand: 0,
                    rebarWeight: 99,
                    laborDays: 2.33,
                    masons: 2,
                    helpers: 2,
                    carpenters: 1,
                    chbCost: 25,
                    cementCost: 250,
                    sandCost: 800,
                    rebarCostPerKg: 45,
                    masonDailyRate: 600,
                    helperDailyRate: 400,
                    carpenterDailyRate: 500,
                    totalMaterialCost: 15066.04,
                    totalLaborCost: 9706.83,
                    wasteFactor: 0.05,
                    overheadAmount: 3828.93,
                    profitAmount: 2935.51,
                    totalProjectCost: 32290.61
                }).map(row => row.cells.map(cell => cell.textContent))
            ];
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, "BOQ");
            XLSX.writeFile(wb, "CHB_Wall_Estimate.xlsx");
        }
    </script>
</body>
</html>
